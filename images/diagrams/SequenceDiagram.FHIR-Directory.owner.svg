<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1235.4167px" preserveAspectRatio="none" style="width:1895px;height:1235px;background:#FFFFFF;" version="1.1" viewBox="0 0 1895 1235" width="1895.8333px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="935.9619" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="363.0208" y="180.2002"/><rect fill="#FFFFFF" height="195.6217" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="676.5625" y="575.4069"/><rect fill="#FFFFFF" height="562.4268" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="881.7708" y="381.1686"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1226.5625" y="981.2337"/><rect fill="#FFFFFF" height="256.3151" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1418.2292" y="605.7536"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1630.7292" y="1055.4688"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1781.7708" y="320.4753"/><rect fill="none" height="696.4518" style="stroke:#000000;stroke-width:1.5625;" width="1622.3958" x="267.7083" y="255.4769"/><rect fill="none" height="589.7868" style="stroke:#000000;stroke-width:1.5625;" width="1601.5625" x="278.125" y="280.6152"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="27.0833" x2="27.0833" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="83.3333" x2="83.3333" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="158.3333" x2="158.3333" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="367.7083" x2="367.7083" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="681.7708" x2="681.7708" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="886.4583" x2="886.4583" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1231.25" x2="1231.25" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1423.4375" x2="1423.4375" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1635.9375" x2="1635.9375" y1="101.6602" y2="1134.9121"/><line style="stroke:#181818;stroke-width:0.5208333333333334;stroke-dasharray:5.0,5.0;" x1="1786.9792" x2="1786.9792" y1="101.6602" y2="1134.9121"/><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="43.75" x="5.2083" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="29.1667" x="12.5" y="89.8875">Bob</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="43.75" x="5.2083" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="29.1667" x="12.5" y="1154.6987">Bob</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="47.9167" x="59.375" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="66.6667" y="89.8875">Alice</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="47.9167" x="59.375" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="66.6667" y="1154.6987">Alice</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="117.7083" y="81.2449">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="128.6458" y="98.2208">oder LE</text><ellipse cx="158.8542" cy="14.0625" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M158.8542,22.3958 L158.8542,50.5208 M145.3125,30.7292 L172.3958,30.7292 M158.8542,50.5208 L145.3125,66.1458 M158.8542,50.5208 L172.3958,66.1458 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="117.7083" y="1147.407">Org-Admin</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="54.1667" x="128.6458" y="1164.3829">oder LE</text><ellipse cx="158.8542" cy="1176.6764" fill="#E3E3E3" rx="8.3333" ry="8.3333" style="stroke:#181818;stroke-width:0.5208333333333334;"/><path d="M158.8542,1185.0098 L158.8542,1213.1348 M145.3125,1193.3431 L172.3958,1193.3431 M158.8542,1213.1348 L145.3125,1228.7598 M158.8542,1213.1348 L172.3958,1228.7598 " fill="none" style="stroke:#181818;stroke-width:0.5208333333333334;"/><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="288.5417" y="35.1074"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="307.2917" y="55.9357">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="351.5625" y="72.9116">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="295.8333" y="89.8875">TI-Messenger-Client</text><rect fill="#E3E3E3" height="65.5111" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="159.375" x="288.5417" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="121.875" x="307.2917" y="1154.6987">Org-Admin-Client</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="33.3333" x="351.5625" y="1171.6746">oder</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="144.7917" x="295.8333" y="1188.6505">TI-Messenger-Client</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="609.8958" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="617.1875" y="72.9116">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="654.1667" y="89.8875">des IDP</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="143.75" x="609.8958" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="129.1667" x="617.1875" y="1154.6987">Authenticator App</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="55.2083" x="654.1667" y="1171.6746">des IDP</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="834.375" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="841.6667" y="89.8875">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="105.2083" x="834.375" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="90.625" x="841.6667" y="1154.6987">Auth-Service</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1186.4583" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1193.75" y="89.8875">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="90.625" x="1186.4583" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="76.0417" x="1193.75" y="1154.6987">FHIR-Proxy</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1358.8542" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1366.1458" y="89.8875">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="129.1667" x="1358.8542" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="114.5833" x="1366.1458" y="1154.6987">Identity Provider</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1577.6042" y="69.0592"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1584.8958" y="89.8875">FHIR-Directory</text><rect fill="#E3E3E3" height="31.5592" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="116.6667" x="1577.6042" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="102.0833" x="1584.8958" y="1154.6987">FHIR-Directory</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1704.6875" y="52.0833"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1737.5" y="72.9116">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1711.9792" y="89.8875">Registrierungsdienst</text><rect fill="#E3E3E3" height="48.5352" rx="2.6042" ry="2.6042" style="stroke:#181818;stroke-width:0.5208333333333334;" width="164.5833" x="1704.6875" y="1133.8704"/><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="98.9583" x="1737.5" y="1154.6987">TI-Messenger</text><text fill="#000000" font-family="sans-serif" font-size="14.5833" lengthAdjust="spacing" textLength="150" x="1711.9792" y="1171.6746">Registrierungsdienst</text><rect fill="#FFFFFF" height="935.9619" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="363.0208" y="180.2002"/><rect fill="#FFFFFF" height="195.6217" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="676.5625" y="575.4069"/><rect fill="#FFFFFF" height="562.4268" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="881.7708" y="381.1686"/><rect fill="#FFFFFF" height="134.9284" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1226.5625" y="981.2337"/><rect fill="#FFFFFF" height="256.3151" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1418.2292" y="605.7536"/><rect fill="#FFFFFF" height="60.6934" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1630.7292" y="1055.4688"/><rect fill="#FFFFFF" height="30.3467" style="stroke:#181818;stroke-width:1.0416666666666667;" width="10.4167" x="1781.7708" y="320.4753"/><polygon fill="#181818" points="70.8333,129.9235,81.25,134.0902,70.8333,138.2568,75,134.0902" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="27.0833" x2="77.0833" y1="134.0902" y2="134.0902"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="31.25" x="34.375" y="128.8132">hello</text><polygon fill="#181818" points="350.5208,176.0335,360.9375,180.2002,350.5208,184.3669,354.6875,180.2002" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="158.8542" x2="356.7708" y1="180.2002" y2="180.2002"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="184.375" x="166.1458" y="159.1599">möchte seinen FHIR-Eintrag</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="46.875" x="166.1458" y="174.9232">ändern</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="417.1875" y1="226.3102" y2="226.3102"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="417.1875" x2="417.1875" y1="226.3102" y2="239.8519"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="374.4792" x2="417.1875" y1="239.8519" y2="239.8519"/><polygon fill="#181818" points="384.8958,235.6852,374.4792,239.8519,384.8958,244.0186,380.7292,239.8519" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="280.2083" x="380.7292" y="205.2699">prüfe ob noch gültiges owner-accesstoken</text><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="288.5417" x="380.7292" y="221.0332">für Schreibzugriff vom Auth-Service vorliegt</text><path d="M267.7083,255.4769 L334.375,255.4769 L334.375,262.9069 L323.9583,273.3236 L267.7083,273.3236 L267.7083,255.4769 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="696.4518" style="stroke:#000000;stroke-width:1.5625;" width="1622.3958" x="267.7083" y="255.4769"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="283.3333" y="269.0882">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="427.0833" x="350" y="268.1961">[kein gültiges owner-accesstoken für Schreibzugriff vorhanden]</text><path d="M278.125,280.6152 L344.7917,280.6152 L344.7917,288.0452 L334.375,298.4619 L278.125,298.4619 L278.125,280.6152 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5625;"/><rect fill="none" height="589.7868" style="stroke:#000000;stroke-width:1.5625;" width="1601.5625" x="278.125" y="280.6152"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="293.75" y="294.2266">alt</text><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="80.2083" x="360.4167" y="293.3345">[Org-Admin]</text><polygon fill="#181818" points="1769.2708,316.3086,1779.6875,320.4753,1769.2708,324.6419,1773.4375,320.4753" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="1775.5208" y1="320.4753" y2="320.4753"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="307.2917" x="380.7292" y="315.1983">POST /regservice/user/{userId}/request_token</text><polygon fill="#181818" points="384.8958,346.6553,374.4792,350.8219,384.8958,354.9886,380.7292,350.8219" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="378.6458" x2="1785.9375" y1="350.8219" y2="350.8219"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="552.0833" x="391.1458" y="345.5449">HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}</text><polygon fill="#181818" points="869.2708,377.002,879.6875,381.1686,869.2708,385.3353,873.4375,381.1686" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="875.5208" y1="381.1686" y2="381.1686"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="488.5417" x="380.7292" y="375.8916">GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="892.1875" x2="935.9375" y1="411.5153" y2="411.5153"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="935.9375" x2="935.9375" y1="411.5153" y2="425.057"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="893.2292" x2="935.9375" y1="425.057" y2="425.057"/><polygon fill="#181818" points="903.6458,420.8903,893.2292,425.057,903.6458,429.2236,899.4792,425.057" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="319.7917" x="899.4792" y="406.2383">verify RegService-OpenID-Token (telematikID,...)</text><line style="stroke:#000000;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="278.125" x2="1879.6875" y1="434.432" y2="434.432"/><text fill="#000000" font-family="sans-serif" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="250" x="283.3333" y="445.0679">[LE mit HBA und TI-Messenger Client]</text><polygon fill="#181818" points="869.2708,466.6585,879.6875,470.8252,869.2708,474.9919,873.4375,470.8252" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="875.5208" y1="470.8252" y2="470.8252"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="163.5417" x="380.7292" y="465.5482">GET /owner-authenticate</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="892.1875" x2="935.9375" y1="501.1719" y2="501.1719"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="935.9375" x2="935.9375" y1="501.1719" y2="514.7135"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="893.2292" x2="935.9375" y1="514.7135" y2="514.7135"/><polygon fill="#181818" points="903.6458,510.5469,893.2292,514.7135,903.6458,518.8802,899.4792,514.7135" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="298.9583" x="899.4792" y="495.8949">Erzeuge PKCE Code für verifier und challenge</text><polygon fill="#181818" points="384.8958,540.8936,374.4792,545.0602,384.8958,549.2269,380.7292,545.0602" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="378.6458" x2="880.7292" y1="545.0602" y2="545.0602"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="292.7083" x="391.1458" y="539.7832">Redirect (302) to IDP Authorization Endpoint</text><polygon fill="#181818" points="664.0625,571.2402,674.4792,575.4069,664.0625,579.5736,668.2292,575.4069" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="670.3125" y1="575.4069" y2="575.4069"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="176.0417" x="380.7292" y="570.1299">Deeplink authenticator://...</text><polygon fill="#181818" points="1405.7292,601.5869,1416.1458,605.7536,1405.7292,609.9202,1409.8958,605.7536" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="686.9792" x2="1411.9792" y1="605.7536" y2="605.7536"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="142.7083" x="694.2708" y="600.4766">GET {auth_endpoint}</text><polygon fill="#181818" points="698.4375,631.9336,688.0208,636.1003,698.4375,640.2669,694.2708,636.1003" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="692.1875" x2="1417.1875" y1="636.1003" y2="636.1003"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="704.6875" y="630.8233">challenge</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="686.9792" x2="730.7292" y1="666.4469" y2="666.4469"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="730.7292" x2="730.7292" y1="666.4469" y2="679.9886"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="688.0208" x2="730.7292" y1="679.9886" y2="679.9886"/><polygon fill="#181818" points="698.4375,675.8219,688.0208,679.9886,698.4375,684.1553,694.2708,679.9886" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="94.7917" x="694.2708" y="661.1699">sign challenge</text><polygon fill="#181818" points="1405.7292,706.1686,1416.1458,710.3353,1405.7292,714.502,1409.8958,710.3353" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="686.9792" x2="1411.9792" y1="710.3353" y2="710.3353"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="114.5833" x="694.2708" y="705.0583">signed_challenge</text><polygon fill="#181818" points="698.4375,736.5153,688.0208,740.682,698.4375,744.8486,694.2708,740.682" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="692.1875" x2="1417.1875" y1="740.682" y2="740.682"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="193.75" x="704.6875" y="735.405">Redirect (302) {auth_code,..)</text><polygon fill="#181818" points="384.8958,766.862,374.4792,771.0286,384.8958,775.1953,380.7292,771.0286" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="378.6458" x2="680.7292" y1="771.0286" y2="771.0286"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="227.0833" x="391.1458" y="765.7516">{client_callback_uri} {auth_code}</text><polygon fill="#181818" points="869.2708,797.2087,879.6875,801.3753,869.2708,805.542,873.4375,801.3753" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="875.5208" y1="801.3753" y2="801.3753"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="323.9583" x="380.7292" y="796.0983">GET /signin-gematik-idp-dienst with {auth_code}</text><polygon fill="#181818" points="1405.7292,827.5553,1416.1458,831.722,1405.7292,835.8887,1409.8958,831.722" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="892.1875" x2="1411.9792" y1="831.722" y2="831.722"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="283.3333" x="899.4792" y="826.445">POST /tokenEndpoint {auth_code, verifier}</text><polygon fill="#181818" points="903.6458,857.902,893.2292,862.0687,903.6458,866.2354,899.4792,862.0687" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="897.3958" x2="1422.3958" y1="862.0687" y2="862.0687"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="141.6667" x="909.8958" y="856.7917">Response {id_token}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="892.1875" x2="935.9375" y1="899.707" y2="899.707"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="935.9375" x2="935.9375" y1="899.707" y2="913.2487"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="893.2292" x2="935.9375" y1="913.2487" y2="913.2487"/><polygon fill="#181818" points="903.6458,909.082,893.2292,913.2487,903.6458,917.4154,899.4792,913.2487" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="186.4583" x="899.4792" y="894.43">erzeuge owner-accesstoken</text><polygon fill="#181818" points="384.8958,939.4287,374.4792,943.5954,384.8958,947.762,380.7292,943.5954" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="378.6458" x2="885.9375" y1="943.5954" y2="943.5954"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="442.7083" x="391.1458" y="938.3184">HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}</text><polygon fill="#181818" points="1214.0625,977.0671,1224.4792,981.2337,1214.0625,985.4004,1218.2292,981.2337" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="373.4375" x2="1220.3125" y1="981.2337" y2="981.2337"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="702.0833" x="380.7292" y="975.9567">POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}</text><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1236.9792" x2="1280.7292" y1="1011.5804" y2="1011.5804"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1280.7292" x2="1280.7292" y1="1011.5804" y2="1025.1221"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1238.0208" x2="1280.7292" y1="1025.1221" y2="1025.1221"/><polygon fill="#181818" points="1248.4375,1020.9554,1238.0208,1025.1221,1248.4375,1029.2887,1244.2708,1025.1221" style="stroke:#181818;stroke-width:1.0416666666666667;"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="166.6667" x="1244.2708" y="1006.3034">prüfe owner-accesstoken</text><polygon fill="#181818" points="1618.2292,1051.3021,1628.6458,1055.4688,1618.2292,1059.6354,1622.3958,1055.4688" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;" x1="1236.9792" x2="1624.4792" y1="1055.4688" y2="1055.4688"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="373.9583" x="1244.2708" y="1050.1918">POST /TIHealthcareService {providedBy.id=telematikID}</text><polygon fill="#181818" points="1248.4375,1081.6488,1238.0208,1085.8154,1248.4375,1089.9821,1244.2708,1085.8154" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="1242.1875" x2="1629.6875" y1="1085.8154" y2="1085.8154"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="1254.6875" y="1080.5384">HTTP 200 OK (Result Body json)</text><polygon fill="#181818" points="379.6875,1111.9954,369.2708,1116.1621,379.6875,1120.3288,375.5208,1116.1621" style="stroke:#181818;stroke-width:1.0416666666666667;"/><line style="stroke:#181818;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="373.4375" x2="1230.7292" y1="1116.1621" y2="1116.1621"/><text fill="#000000" font-family="sans-serif" font-size="13.5417" lengthAdjust="spacing" textLength="209.375" x="385.9375" y="1110.8851">HTTP 200 OK (Result Body json)</text><!--MD5=[6d2e19c2856e60f73ef2926287cd4ecf]
@startuml
Bob -> Alice : hello

skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

'title "FHIR-Directory, Sequenzdiagram Änderung von eigenen Einträgen'
actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
au -> au: verify RegService-OpenID-Token (telematikID,...)
else LE mit HBA und TI-Messenger Client
cl -> au: GET /owner-authenticate
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect (302) to IDP Authorization Endpoint
cl -> aa: Deeplink authenticator://...
activate aa

aa -> idp: GET {auth_endpoint}
activate idp
idp - -> aa: challenge
aa -> aa: sign challenge
aa-> idp: signed_challenge
idp - -> aa: Redirect (302) {auth_code,..)
aa - -> cl: {client_callback_uri} {auth_code}
deactivate aa

cl -> au: GET /signin-gematik-idp-dienst with {auth_code}
au -> idp: POST /tokenEndpoint {auth_code, verifier}
idp - -> au: Response {id_token}

deactivate idp
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

@startuml
Bob -> Alice : hello

skinparam dpi 100
skinparam WrapWidth 200
skinparam monochrome true

actor o as "Org-Admin\noder LE"
participant cl as "Org-Admin-Client\noder\nTI-Messenger-Client"
participant aa as "Authenticator App\ndes IDP"
participant au as "Auth-Service"
participant fp as "FHIR-Proxy"
participant idp as "Identity Provider"
participant fd as "FHIR-Directory"
participant rd as "TI-Messenger\nRegistrierungsdienst"
o -> cl: möchte seinen FHIR-Eintrag\nändern
activate cl
cl -> cl: prüfe ob noch gültiges owner-accesstoken\nfür Schreibzugriff vom Auth-Service vorliegt
alt kein gültiges owner-accesstoken für Schreibzugriff vorhanden
alt Org-Admin
cl -> rd: POST /regservice/user/{userId}/request_token
activate rd
rd - -> cl: HTTP 200 OK, Result body {"access_token": "RegService-OpenID-Token=id_token"}
deactivate rd
cl -> au: GET /owner-authenticate... ((Auth Header mit RegService-OpenID-Token))
activate au
au -> au: verify RegService-OpenID-Token (telematikID,...)
else LE mit HBA und TI-Messenger Client
cl -> au: GET /owner-authenticate
au -> au: Erzeuge PKCE Code für verifier und challenge
au - -> cl: Redirect (302) to IDP Authorization Endpoint
cl -> aa: Deeplink authenticator://...
activate aa

aa -> idp: GET {auth_endpoint}
activate idp
idp - -> aa: challenge
aa -> aa: sign challenge
aa-> idp: signed_challenge
idp - -> aa: Redirect (302) {auth_code,..)
aa - -> cl: {client_callback_uri} {auth_code}
deactivate aa

cl -> au: GET /signin-gematik-idp-dienst with {auth_code}
au -> idp: POST /tokenEndpoint {auth_code, verifier}
idp - -> au: Response {id_token}

deactivate idp
end
au -> au: erzeuge owner-accesstoken
au - -> cl: HTTP 200 OK, Result body {"access_token"="owner-accesstoken"}
deactivate au
end
cl -> fp: POST /owner/TIHealthcareService (Authorization Bearer owner-accesstoken) {providedBy.id=telematikID}
activate fp
fp -> fp: prüfe owner-accesstoken
fp -> fd: POST /TIHealthcareService {providedBy.id=telematikID}
activate fd
fd - -> fp: HTTP 200 OK (Result Body json)
fp - -> cl: HTTP 200 OK (Result Body json)
deactivate fd
deactivate fp
deactivate cl
@enduml

PlantUML version 1.2022.13(Sat Nov 19 13:22:17 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>